name: Scorecard supply-chain security
on:
    # For Branch-Protection check. Only the default branch is supported. See
    # https://github.com/ossf/scorecard/blob/main/docs/checks.md#branch-protection
    branch_protection_rule:
    # To guarantee Maintained check is occasionally updated. See
    # https://github.com/ossf/scorecard/blob/main/docs/checks.md#maintained
    schedule:
        - cron: "30 1 * * 1"
    push:
        branches: ["main"]

# Declare default permissions as read only.
permissions: read-all

jobs:
    analysis:
        name: Scorecard analysis
        runs-on: ubuntu-latest
        permissions:
            # Needed to upload the results to code-scanning dashboard.
            security-events: write
            # Needed to publish results and get a badge (see publish_results below)
            id-token: write
            # Needed for checkout and GraphQL API access
            contents: read
            actions: read
            # Needed for Scorecard to access repository metadata
            pull-requests: read
            issues: read
            checks: read
            statuses: read

        steps:
            - name: "Checkout code"
              uses: actions/checkout@v4
              with:
                  persist-credentials: false

            - name: "Run analysis"
              uses: ossf/scorecard-action@v2.4.0
              with:
                  results_file: results.sarif
                  results_format: sarif
                  # Public repositories:
                  #   - Publish results to OpenSSF REST API for easy access by consumers
                  #   - Allows the repository to include the Scorecard badge.
                  #   - See https://github.com/ossf/scorecard-action#publishing-results.
                  publish_results: true

            # Upload the results as artifacts (optional).
            - name: "Upload artifact"
              uses: actions/upload-artifact@v6
              with:
                  name: SARIF file
                  path: results.sarif
                  retention-days: 5

            # Upload the results to GitHub's code scanning dashboard.
            - name: "Upload to code-scanning"
              uses: github/codeql-action/upload-sarif@v4
              with:
                  sarif_file: results.sarif
